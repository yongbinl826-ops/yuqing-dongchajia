# 舆情洞察家 - 操作说明书

## 项目概述

**项目名称**：舆情洞察家（Opinion Insight Master）

**项目类型**：AI驱动的舆情监控与分析系统

**核心功能**：
- 多平台舆情数据采集（Twitter、Reddit、YouTube等）
- 基于AI的情感分析和关键词提取
- 实时舆情监控和趋势分析
- 可视化数据展示

**技术栈**：
- 前端：React + TypeScript + Vite
- 后端：Node.js + Express + tRPC
- 数据库：MySQL 8.0+
- AI服务：Python FastAPI + Transformers
- 采集器：Python + Playwright

---

## 系统要求

### 最低配置
- **操作系统**：Windows 10/11 或 Linux (Ubuntu 20.04+)
- **CPU**：4核心及以上
- **内存**：8GB RAM
- **硬盘**：10GB可用空间
- **Node.js**：v18.0.0 或更高版本
- **Python**：3.9 或更高版本
- **MySQL**：8.0 或更高版本

### 推荐配置
- **操作系统**：Windows 11 或 Ubuntu 22.04
- **CPU**：8核心及以上
- **内存**：16GB RAM
- **硬盘**：20GB SSD
- **Node.js**：v22.0.0+
- **Python**：3.11+
- **MySQL**：8.0.44+

---

## 安装步骤

### 第一步：安装依赖软件

#### Windows用户
1. 下载并安装 Node.js (https://nodejs.org/)
2. 下载并安装 Python 3.11+ (https://www.python.org/)
3. 下载并安装 MySQL 8.0+ (https://dev.mysql.com/downloads/mysql/)

#### Linux用户（Ubuntu）
```bash
# 更新包管理器
sudo apt-get update

# 安装Node.js
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装Python
sudo apt-get install -y python3.11 python3-pip

# 安装MySQL
sudo apt-get install -y mysql-server
```

### 第二步：配置数据库

1. **启动MySQL服务**
   ```bash
   # Windows
   net start MySQL80
   
   # Linux
   sudo service mysql start
   ```

2. **创建数据库和用户**
   ```bash
   mysql -u root -p
   ```
   
   在MySQL命令行中执行：
   ```sql
   CREATE DATABASE yuqing_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   CREATE USER 'yuqing_user'@'localhost' IDENTIFIED BY 'yuqing_pass_2024';
   GRANT ALL PRIVILEGES ON yuqing_db.* TO 'yuqing_user'@'localhost';
   FLUSH PRIVILEGES;
   EXIT;
   ```

### 第三步：安装项目依赖

1. **进入项目目录**
   ```bash
   cd yuqing_dongchajia
   ```

2. **安装Node.js依赖**
   ```bash
   npm install -g pnpm
   pnpm install
   ```

3. **安装Python依赖**
   ```bash
   pip install -r requirements.txt
   ```

### 第四步：配置环境变量

在项目根目录创建 `.env` 文件：

```env
# 数据库配置
DATABASE_URL=mysql://yuqing_user:yuqing_pass_2024@localhost:3306/yuqing_db

# OAuth配置（可选，用于用户认证）
OAUTH_CLIENT_ID=your_client_id
OAUTH_CLIENT_SECRET=your_client_secret

# 服务端口
PORT=3001
NLP_SERVICE_PORT=8000
```

---

## 运行项目

### 方式一：开发模式（推荐用于开发）

1. **启动NLP服务**
   ```bash
   python3 nlp_service.py
   ```
   
   服务将在 `http://localhost:8000` 启动

2. **在新终端启动Web服务**
   ```bash
   PORT=3001 pnpm start
   ```
   
   应用将在 `http://localhost:3001` 启动

### 方式二：生产模式（推荐用于演示）

1. **构建项目**
   ```bash
   pnpm build
   ```

2. **启动NLP服务**
   ```bash
   nohup python3 nlp_service.py > nlp_service.log 2>&1 &
   ```

3. **启动Web服务**
   ```bash
   PORT=3001 nohup pnpm start > web_service.log 2>&1 &
   ```

---

## 使用指南

### 1. 访问应用

打开浏览器，访问：`http://localhost:3001`

### 2. 创建监控任务

1. 点击"创建新任务"按钮
2. 输入监控关键词（例如：人工智能、AI、机器学习）
3. 选择数据源平台（Twitter、Reddit、YouTube等）
4. 点击"创建任务"

### 3. 开始数据采集

1. 在任务列表中找到创建的任务
2. 点击任务进入详情页
3. 点击"开始采集"按钮
4. 系统将自动采集相关数据并进行情感分析

### 4. 查看分析结果

- **Dashboard**：查看任务统计和数据概览
- **任务详情**：查看采集的评论和情感分析结果
- **可视化图表**：查看情感分布和趋势分析

### 5. 导出数据

点击"导出"按钮可将分析结果导出为CSV或Excel格式

---

## 项目结构

```
yuqing_dongchajia/
├── client/                          # 前端代码
│   ├── src/
│   │   ├── components/             # React组件
│   │   ├── pages/                  # 页面
│   │   ├── styles/                 # 样式文件
│   │   └── App.tsx                 # 主应用
│   └── index.html
├── server/                          # 后端代码
│   ├── _core/                      # 核心服务
│   │   ├── index.ts               # 服务器入口
│   │   ├── trpc.ts                # tRPC配置
│   │   └── env.ts                 # 环境变量
│   ├── routers/                    # API路由
│   │   ├── collector.ts           # 采集路由
│   │   ├── analysis.ts            # 分析路由
│   │   └── export.ts              # 导出路由
│   ├── collectors/                 # 数据采集器
│   │   ├── demo_with_mock_data.py # 模拟数据采集脚本
│   │   ├── twitter_collector.py   # Twitter采集器
│   │   ├── reddit_collector.py    # Reddit采集器
│   │   └── youtube_collector.py   # YouTube采集器
│   ├── db.ts                       # 数据库操作
│   └── nlp_service.py              # NLP分析服务
├── drizzle/                         # 数据库schema
│   └── schema.ts                   # 表结构定义
├── dist/                           # 构建输出
├── package.json                    # Node.js配置
├── requirements.txt                # Python依赖
├── .env                            # 环境变量
├── vite.config.ts                  # Vite配置
├── tsconfig.json                   # TypeScript配置
└── README.md                       # 项目说明

```

---

## 主要功能详解

### 1. 舆情监控
- 支持多平台数据采集
- 实时监控关键词相关内容
- 自动去重和数据清洗

### 2. 情感分析
- 基于Transformers的深度学习模型
- 支持中文和英文
- 返回情感分类（正面/负面/中立）和置信度

### 3. 关键词提取
- 基于TF-IDF算法
- 自动识别高频关键词
- 支持中文分词

### 4. 数据可视化
- 情感分布饼图
- 时间序列趋势图
- 关键词词云图

### 5. 数据导出
- 支持CSV格式导出
- 支持Excel格式导出
- 包含完整的分析结果

---

## 故障排除

### 问题1：无法连接到数据库
**症状**：启动时显示"Database connection failed"

**解决方案**：
1. 检查MySQL是否正在运行：`mysql -u root -p`
2. 验证数据库凭证是否正确
3. 检查`.env`文件中的`DATABASE_URL`配置

### 问题2：NLP服务无法启动
**症状**：采集时显示"NLP service not responding"

**解决方案**：
1. 确保Python依赖已安装：`pip install -r requirements.txt`
2. 检查端口8000是否被占用
3. 查看NLP服务日志：`tail -f nlp_service.log`

### 问题3：采集脚本无法运行
**症状**：点击"开始采集"后没有反应

**解决方案**：
1. 检查Python脚本权限：`chmod +x server/collectors/demo_with_mock_data.py`
2. 验证脚本路径是否正确
3. 查看Web服务日志：`tail -f web_service.log`

### 问题4：前端页面加载缓慢
**症状**：访问应用时加载时间长

**解决方案**：
1. 清除浏览器缓存
2. 检查网络连接
3. 确保后端服务正常运行

---

## 性能优化建议

1. **数据库优化**
   - 为常用查询字段添加索引
   - 定期清理过期数据
   - 使用连接池管理数据库连接

2. **前端优化**
   - 启用代码分割和懒加载
   - 压缩静态资源
   - 使用CDN加速

3. **后端优化**
   - 实现缓存机制
   - 使用消息队列处理异步任务
   - 优化数据库查询

4. **采集优化**
   - 实现增量采集
   - 使用多线程并行采集
   - 添加重试机制

---

## 扩展功能

### 添加新的数据源
1. 在`server/collectors/`目录下创建新的采集器
2. 实现采集逻辑和数据转换
3. 在`collector.ts`中注册新的采集器

### 自定义分析模型
1. 修改`nlp_service.py`中的模型配置
2. 使用自己的预训练模型
3. 添加新的分析功能

### 集成外部API
1. 在`server/routers/`中添加新的路由
2. 实现API调用逻辑
3. 更新前端以支持新功能

---

## 常见问题

**Q: 项目支持哪些平台的数据采集？**
A: 目前支持Twitter、Reddit、YouTube、Weibo、Zhihu等平台。系统采用模拟数据演示，可根据需要配置真实API。

**Q: 数据采集需要多长时间？**
A: 采集速度取决于数据源和网络连接。通常采集100条数据需要1-5分钟。

**Q: 可以同时运行多个采集任务吗？**
A: 可以。系统支持并行采集，但建议不超过5个并发任务。

**Q: 如何修改情感分析模型？**
A: 编辑`nlp_service.py`中的模型配置，更换为其他预训练模型。

**Q: 项目可以部署到云服务器吗？**
A: 可以。支持部署到AWS、阿里云、腾讯云等云平台。

---

## 技术支持

如有问题，请检查以下文件：
- 项目说明：`README.md`
- 问题清单：`ISSUES_AND_SOLUTIONS.md`
- 修复报告：`REPAIR_SUMMARY.md`

---

## 许可证

本项目仅供学习和研究使用。

---

**最后更新**：2025年11月22日
**版本**：1.0.0
